<html>

<head>
  <title>Final Project</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="stylesheets/style.css">
  <link rel="icon" href="/images/baby.png" type="image/png">
</head>

<body>

  <script>
    window.activeTimeouts = [];
    const _originalSetTimeout = window.setTimeout;
    window.setTimeout = function (func, delay) {
      const id = _originalSetTimeout(func, delay);
      window.activeTimeouts.push(id);
      return id;
    };
    function clearAllTimeouts() {
      window.activeTimeouts.forEach(id => clearTimeout(id));
      window.activeTimeouts = [];
    }
  </script>

  <main id="ui-layer">
    <div id="button-container">
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.1/p5.min.js"></script>
  <script src="./sketch.js"></script>

  <h1 class="text-click">請點擊螢幕</h1>

  <div class="menu">
    <h1 class="title"><span>代</span><span>理</span><span>孕</span><span>母</span><span>之</span><span>路</span></h1>
    <h3 class="sub-title">
      <span>R</span><span>O</span><span>A</span><span>D&emsp;</span><span>T</span><span>O&emsp;</span><span>S</span><span>U</span><span>R</span><span>R</span><span>O</span><span>G</span><span>A</span><span>C</span><span>Y</span>
    </h3>
    <button class="start-button"> START </button>

  </div>


  <div class="FirstScene">
    <h1 class="TypeWriter" data-id="1">
      <span>你失業半年，家裡房貸快繳不出來。</span>
      <span>有人介紹你一份「高報酬工作」。</span>
    </h1>
    <button class="continue-button" data-action="whatjob">什麼工作？</button>
    <h1 class="TypeWriter" data-id="2">
      <span>⋯借出你的子宮。</span>
    </h1>
    <div class="choice-block">
      <button class="continue-button" data-action="agree">我願意</button>
      <button class="continue-button" data-action="disagree">我再想想...</button>
    </div>
    <h1 class="TypeWriter" data-id="3">
      <span>這份工作只是懷一個孩子，之後就沒你的事了。</span>
      <span> 這是一份助人圓夢的「服務」。</span>
    </h1>
    <button class="continue-button" data-action="then">所以呢？</button>
    <h1 class="TypeWriter" data-id="4">
      <span>你沒有選擇的餘地。</span>
    </h1>
    <button class="continue-button" data-action="agreeTwo">我願意...</button>

    <h1 class="TypeWriter" data-id="5">
      <span>太棒了！開始工作之前，你得先簽一份合約。</span>
    </h1>

    <button class="continue-button" data-action="ok">好的</button>

    <div class="contact" data-id="1">
      <h1>代孕條約</h1>
      <p>1. 基本報酬自胚胎植入且胎兒心跳確認後開始計算。<br>2. 孕母同意遵照醫療團隊指示，不得自行終止妊娠。<br>3. 妊娠期間，不得進行高強度活動與搭機旅行，飲食也必須受到嚴格管控。<br></p>
      <p style="color:red">註：若妊娠失敗，報酬即停止，且孕母必須承受一切法律責任。</p>
      <p> 簽名處：</p>


      <div id="signature-container" class="signature-container">
        <div class="canvas-wrapper">
          <canvas id="drawing-board" style="width: 70vw; height: 20vh"></canvas>
        </div>

        <div class="sig-buttons">
          <button id="clear-btn" data-action="clear" class="continue-button">重寫</button>
          <button id="confirm-sign-btn" data-action="confirm" class="continue-button">確定</button>
        </div>
      </div>
    </div>





    <!-- <button class="change-button" data-next="SecondScene" data-action="TriggerSecondScene"> 下一幕 </button> -->
  </div>

  <div class="SecondScene">
    <h1 class="TypeWriter" data-id="21">
      <span>隨著契約生效，你的身體變成了計畫的一部分。</span>
    </h1>
    <button class="continue-button" data-action="two-one-btn">瞭解</button>


    <h1 class="TypeWriter" data-id="22">
      <span>醫生說，為提升胚胎著床的成功率。</span>
      <span>你必須每天在固定時間注射激素。</span>
    </h1>

    <div id="injection-hint" class="scroll-hint">
      <p>請點擊您的身體進行注射。</p>
    </div>


    <h1 class="TypeWriter" data-id="23">
      <span>「腹脹、噁心、頭痛⋯⋯醫生說這是正常反應」</span>
      <span>「我真的得為了賺錢這樣折磨我的身體嗎？」</span>
    </h1>

    <h1 class="normal" data-id="24">
      <span style="font-size: 36px"> 代孕小知識 </span>
      <span>輔助生殖技術（ART）的激素療程可能導致 卵巢過度刺激症候群（OHSS），症狀包含腹脹、嘔吐、氣喘等。</span>
    </h1>

    <button class="continue-button" data-action="two-two-btn">繼續</button>


    <h1 class="TypeWriter" data-id="25">
      <span>今天產檢時，你的血壓數字不正常。</span>
      <span>醫生皺起眉頭，要求你立刻進行密集檢查。</span>
    </h1>

    <button class="continue-button" data-action="two-three-btn">測量血壓</button>


    <div id="blood-pressure-hint" class="scroll-hint">
      <p>請長按您的身體測量血壓。</p>
    </div>

    <div id="bp-warning">
      ⚠️ 警告！血壓過高！⚠️
    </div>

    <h1 class="TypeWriter" data-id="26">
      <span> 「我的血壓太高了，我是不是做錯了什麼？」</span>
      <span>「這孩子不屬於我…難道我的身體正在排斥它嗎？」</span>
    </h1>

    <h1 class="normal" data-id="27">
      <span style="font-size: 36px"> 代孕小知識 </span>
      <span>孕期若免疫調節不平衡，可能增加子癇前症（Preeclampsia）風險。代孕懷胎涉及父母不同基因來源，可能增加免疫負荷。</span>
    </h1>

    <button class="continue-button" data-action="two-four-btn">繼續</button>



    <h1 class="TypeWriter" data-id="28">
      <span>這次的植入又失敗了。</span>
      <span>醫生建議立刻進行下一次植入手術。</span>
      <span>你若拒絕，合約將立即終止。</span>
    </h1>

    <button class="continue-button" data-action="two-five-btn">進行手術</button>

    <div id="embryo-hint" class="scroll-hint">
      <div class="arrow"></div>
      <p>請向上滑動螢幕以注入胚胎</p>
    </div>

    <h1 class="TypeWriter" data-id="29">
      <span>「再來一次……我已經不知道是第幾次了。」</span>
      <span>「 但若不成功，我什麼都拿不到。」</span>
      <span>「我真的別無選擇。」</span>
    </h1>



    <h1 class="normal" data-id="291">
      <span style="font-size: 36px"> 代孕小知識 </span>
      <span>代孕若第一次植入不成功，常需進行多次激素療程與植入，增加身體負擔與心理壓力。</span>
    </h1>

    <button class="continue-button" data-action="two-six-btn">繼續</button>



    <!-- <button class="change-button" data-next="ThirdScene" data-action="TriggerThirdScene"> 下一幕 </button> -->
  </div>

  <div class="ThirdScene">
    <h1 class="TypeWriter" data-id="31">
      <span>你努力了將近一年，孩子終於出生了。</span>
    </h1>
    <button class="continue-button" data-action="three-one-btn">太好了？</button>

    <h1 class="TypeWriter" data-id="32">
      <span>護士沒有問你要不要抱孩子。</span>
      <span>因為，合約早就簽好了。</span>
      <span>孩子真正的父母正準備帶走他。</span>
    </h1>
    <button class="continue-button" data-action="three-two-btn">憑什麼？</button>

    <div id="baby-hint" class="scroll-hint">
      <p>孩子即將離去，請點擊螢幕挽留他。</p>
    </div>

    <h1 class="TypeWriter" data-id="34">
      <span>「他被抱走的瞬間，我的身體像被掏空了一樣。」</span>
      <span>「我知道他不屬於我，但我的身體記得他來過。」</span>
    </h1>

    <h1 class="TypeWriter" data-id="35">
      <span>「拜託別走⋯」</span>
    </h1>

    <div class="contact" data-id="3">
      <h1>代孕條約</h1>
      <p>1. 基本報酬自胚胎植入且胎兒心跳確認後開始計算。<br>2. 孕母同意遵照醫療團隊指示，不得自行終止妊娠。<br>3. 妊娠期間，孕母不得進行高強度活動與搭機旅行，飲食也必須受到嚴格管控。<br></p>
      <p style="color:red">註：若妊娠失敗，報酬即停止，且孕母必須承受一切法律責任。<br></p>
      <p> 簽名處：</p>

      <div class="canvas-wrapper">
        <img id="signature-preview" src="" alt="您的簽名"
          style="width: 100%; height: 100%; object-fit: contain; display: none;">
      </div>
    </div>

    <button class="continue-button" data-action="three-three-btn">完成合約</button>

    <!-- <button class="change-button" data-next="FourthScene" data-action="TriggerFourthScene"> 下一幕 </button> -->

  </div>
  <div class="FourthScene">

    <h1 class="TypeWriter" data-id="41">
      <span>剛剛，你用她的視角，承受了身體與情感的代價。</span>
    </h1>
    <button class="continue-button" data-action="four-one-btn">好痛苦...</button>

    <h1 class="TypeWriter" data-id="42">
      <span>現在，輪到你用自己的名字，決定制度的樣子。</span>
    </h1>
    <button class="continue-button" data-action="four-two-btn">我準備好了</button>

    <h1 class="TypeWriter" data-id="43">
      <span>現在的你，對於代孕的想法是什麼呢？</span>
    </h1>

    <div class="final-decision">
      <button class="continue-button" data-action="four-three-btn">
        <h1>支持</h1>
        <p>你選擇讓國家建立完善機制，讓想成家的家庭與代孕者能在安全條件下合作。</p>
      </button>
      <button class="continue-button" data-action="four-four-btn">
        <h1>反對</h1>
        <p>你認為代孕會使女性身體商品化，尤其威脅經濟弱勢者，因此堅決反對。</p>
      </button>
      <button class="continue-button" data-action="four-five-btn">
        <h1>按下暫停鍵</h1>
        <p>你主張先進行公聽會、研究兒童最佳利益、婦女健康與法律影響後再做決策。</p>
      </button>
    </div>

    <h1 class="TypeWriter" data-id="44">
      <span>無論你的答案是什麼，來看看大家的選擇吧！</span>
    </h1>

    <div class="end-options">
      <button class="continue-button" data-action="restart">再玩一次</button>
      <button class="continue-button" data-action="pure-background">點我看動畫</button>
    </div>

    <div class="StatsBoard" id="vote-stats-display">
      <h1 class="stats-title">即時投票統計</h1>

      <div class="stats-row">
        <span>支持票數：</span>
        <span id="vote-support" class="vote-number">0</span>
      </div>

      <div class="stats-row">
        <span>反對票數：</span>
        <span id="vote-number-oppose" class="vote-number">0</span>
      </div>

      <div class="stats-row">
        <span>暫停票數：</span>
        <span id="vote-pause" class="vote-number">0</span>
      </div>

      <hr style="width: 50%; border: 1px solid white; margin: 20px 0;">

      <div class="stats-row total">
        <span>總投票數：</span>
        <span id="vote-total" class="vote-number">0</span>
      </div>
    </div>

    <button
      class="continue-button"
      id="back-home-btn"
    >
      回首頁
    </button>
  </div>
<!-- 開發工具
  <div id="dev-panel"
    style="position: fixed; bottom: 10px; right: 10px; z-index: 9999; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 10px; border: 1px solid #555; display: flex; flex-direction: column; gap: 8px; font-family: sans-serif;">
    <button onclick="skipToScene(2)"
      style="padding: 5px 10px; cursor: pointer; background: #333; color: white; border: 1px solid #777; border-radius: 4px;">第
      2 幕：醫療過程</button>
    <button onclick="skipToScene(3)"
      style="padding: 5px 10px; cursor: pointer; background: #333; color: white; border: 1px solid #777; border-radius: 4px;">第
      3 幕：孩子出生</button>
    <button onclick="skipToScene(4)"
      style="padding: 5px 10px; cursor: pointer; background: #333; color: white; border: 1px solid #777; border-radius: 4px;">第
      4 幕：對話開始</button>
    <button onclick="skipToScene(4.5)"
      style="padding: 5px 10px; cursor: pointer; background: #d9534f; color: white; border: 1px solid #d43f3a; border-radius: 4px; font-weight: bold;">直接進入投票</button>
    <button onclick="document.getElementById('dev-panel').style.display='none'"
      style="margin-top:5px; font-size:10px; background:none; border:none; color:#aaa; cursor:pointer;">[關閉面板]</button>
  </div>

  <script>

    function hideAllElements(selector) {
      document.querySelectorAll(selector).forEach(el => {
        el.style.display = 'none';
        el.style.opacity = 0;
        el.style.pointerEvents = 'none';
      });
    }

    function skipToScene(sceneIndex) {
      if (window.activeTimeouts) {
        window.activeTimeouts.forEach(id => clearTimeout(id));
        window.activeTimeouts = [];
      }

      if (typeof sfxType !== 'undefined') { sfxType.pause(); sfxType.currentTime = 0; }
      if (typeof sfxBaby !== 'undefined') { sfxBaby.pause(); sfxBaby.currentTime = 0; }

      document.querySelector('.menu').style.display = 'none';
      ['FirstScene', 'SecondScene', 'ThirdScene', 'FourthScene'].forEach(cls => {
        const el = document.querySelector('.' + cls);
        if (el) {
          el.classList.remove('active');
          el.style.display = 'none';

          hideAllElements('.' + cls + ' .TypeWriter');
          hideAllElements('.' + cls + ' .continue-button');
          hideAllElements('.' + cls + ' .normal');
          hideAllElements('.scroll-hint'); 

          if (cls === 'FirstScene') hideAllElements('.contact[data-id="1"]');
        }
      });

      if (sceneIndex === 2) {
        const scene = document.querySelector('.SecondScene');
        scene.style.display = 'flex';
        setTimeout(() => scene.classList.add('active'), 10);
        if (typeof setSceneState !== 'undefined') setSceneState(1); // POST_INJECT

        resetElement('.TypeWriter[data-id="21"]');
        resetElement('.continue-button[data-action="two-one-btn"]');
      }
      else if (sceneIndex === 3) {
        const scene = document.querySelector('.ThirdScene');
        scene.style.display = 'flex';
        setTimeout(() => scene.classList.add('active'), 10);
        if (typeof setSceneState !== 'undefined') setSceneState(5); // BABY

        resetElement('.TypeWriter[data-id="31"]');
        resetElement('.continue-button[data-action="three-one-btn"]');
        if (typeof sfxBaby !== 'undefined') sfxBaby.play().catch(e => { });
      }
      else if (sceneIndex === 4) {
        const scene = document.querySelector('.FourthScene');
        scene.style.display = 'flex';
        setTimeout(() => scene.classList.add('active'), 10);
        if (typeof setSceneState !== 'undefined') setSceneState(7); // ENDING

        document.querySelector('.final-decision').style.display = 'none';
        resetElement('.TypeWriter[data-id="41"]');
        resetElement('.continue-button[data-action="four-one-btn"]');
      }
      else if (sceneIndex === 4.5) {
        const scene = document.querySelector('.FourthScene');
        scene.style.display = 'flex';
        setTimeout(() => scene.classList.add('active'), 10);
        if (typeof setSceneState !== 'undefined') setSceneState(7);

        document.querySelectorAll('.FourthScene .TypeWriter').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.FourthScene .continue-button').forEach(el => el.style.display = 'none');

        const qText = document.querySelector('.TypeWriter[data-id="43"]');
        if (qText) {
          qText.style.display = 'flex';
          qText.style.opacity = 1;
        }

        const finalDec = document.querySelector('.final-decision');
        if (finalDec) {
          finalDec.style.display = 'flex';
          finalDec.style.opacity = 1;

          const btns = finalDec.querySelectorAll('button');
          btns.forEach(btn => {
            btn.style.display = 'flex';
            btn.style.opacity = 1;
            btn.style.pointerEvents = 'auto';
            btn.disabled = false;
          });
        }
      }

      if (typeof bgm !== 'undefined' && bgm.paused) {
        bgm.volume = 0.5;
        bgm.play().catch(e => { });
      }
    }

    function resetElement(selector) {
      const el = document.querySelector(selector);
      if (el) {
        el.style.display = 'flex';
        el.style.opacity = 1;
        el.style.pointerEvents = 'auto';
        if (el.classList.contains('TypeWriter')) el.classList.add('start-typing');
      }
    }
  </script>-->

  <script src="script.js"></script>
</body>

</html>